# 二人小组作业成绩整理工具

## 功能说明

这个脚本用于将二人小组作业的批改结果按照学生选课名单的顺序进行整理和输出。

## 主要功能

1. **读取学生选课名单**：从 `2024-2025-秋-302074030-02-机械原理-选课学生名单-2025-09-28.xls` 文件中读取学生信息（学号和姓名），从B8和C8单元格开始读取。

2. **读取分组信息**：从 `分组-2025-2026-秋-302074030-02-机械原理.xlsx` 文件中读取二人小组的分组信息，建立学号到组号的映射关系。
   - **支持空组号行**：如果某行的组号列为空，会继续使用上一个组号，直到遇到新的组号或完全空行
   - **支持单人小组**：可以正确处理只有一个成员的小组

3. **读取批改结果**：从 `二人小组作业-批改.xlsx` 文件中读取各章节的批改成绩，每个工作表代表一个章节。

4. **生成整理后的成绩表**：按照学生选课名单的顺序，将每个学生的组号和各章节成绩整理到一个Excel文件中。

## 分组表格式说明

脚本支持以下分组表格式：

```
组号 | 学号1      | 学号2      | ...
1    | 2024xxx   | 2024yyy   |
     | 2024zzz   |           |  <- 空组号，属于第1组
2    | 2024aaa   | 2024bbb   |
3    | 2024ccc   |           |  <- 单人小组
     |           |           |  <- 完全空行，重置组号
4    | 2024ddd   | 2024eee   |
```

**关键特性**：
- 如果某行的组号列为空，但有学号数据，这些学号属于上一个组号
- 如果某行完全为空（所有列都是空），则重置当前组号
- 支持单人小组（只有一个成员的小组）
- 支持人数不足或超出的小组

## 输出格式

生成的Excel文件包含以下列：
- **A列**：序号
- **B列**：学号
- **C列**：姓名
- **D列**：二人小组组号
- **E列及之后**：各章节的成绩（按章节名称排序）

## 使用方法

### 1. 安装依赖

确保已安装必要的Python库：

```bash
pip install openpyxl xlrd
```

### 2. 运行脚本

**二人小组作业：**
```bash
python 整理二人小组作业成绩.py
```

**十人小组作业：**
```bash
python 整理十人小组作业成绩.py
```

### 3. 交互选项

运行脚本后，会提示：

```
是否在输出文件名中添加时间戳？(y/n，默认y):
```

- 输入 `y` 或直接回车：生成带时间戳的文件名，如 `二人小组作业-成绩整理_20260115_112233.xlsx`
- 输入 `n`：使用固定文件名 `二人小组作业-成绩整理.xlsx`（如果文件已存在会提示是否覆盖）

## 文件路径配置

脚本中的文件路径可以在代码开头修改：

**二人小组作业脚本：**
```python
# 文件路径
student_list_file = r"E:\Projects\Intelligent_Teaching_Assistant\2024-2025-秋-302074030-02-机械原理-选课学生名单-2025-09-28.xls"
group_file = r"E:\Projects\Intelligent_Teaching_Assistant\分组-2025-2026-秋-302074030-02-机械原理.xlsx"
grade_file = r"E:\Projects\Intelligent_Teaching_Assistant\二人小组作业-批改.xlsx"
default_output_file = r"E:\Projects\Intelligent_Teaching_Assistant\二人小组作业-成绩整理.xlsx"
```

**十人小组作业脚本：**
```python
# 文件路径
student_list_file = r"E:\Projects\Intelligent_Teaching_Assistant\2024-2025-秋-302074030-02-机械原理-选课学生名单-2025-09-28.xls"
group_file = r"E:\Projects\Intelligent_Teaching_Assistant\分组-2025-2026-秋-302074030-02-机械原理.xlsx"
grade_file = r"E:\Projects\Intelligent_Teaching_Assistant\十人小组作业-批改.xlsx"
default_output_file = r"E:\Projects\Intelligent_Teaching_Assistant\十人小组作业-成绩整理.xlsx"
```

## 注意事项

1. **学号格式**：脚本会自动处理学号格式，去除空格和可能的 `.0` 后缀。

2. **分组表格式**：
   - 支持空组号行（继承上一个组号）
   - 遇到完全空行时会重置组号
   - 支持单人小组和人数不定的小组

3. **章节排序**：输出文件中的章节列按照章节名称排序（如：第2章、第8章、第11章）。

4. **统计信息**：脚本运行完成后会显示：
   - 总学生数
   - 章节数
   - 已分组学生数
   - 未分组学生数

## 示例输出

```
============================================================
二人小组作业成绩整理工具
============================================================

功能说明：
1. 读取学生选课名单（学号和姓名）
2. 读取分组信息（二人小组）
3. 读取批改结果（各章节成绩）
4. 按学生选课名单顺序输出成绩表

============================================================

是否在输出文件名中添加时间戳？(y/n，默认y): n
文件 E:\Projects\Intelligent_Teaching_Assistant\二人小组作业-成绩整理.xlsx 已存在，是否覆盖？(y/n): y
正在加载学生选课名单...
无法直接读取.xls文件，尝试使用xlrd...
共加载 78 名学生
正在加载分组信息...
使用工作表: 二人小组分组
共加载 158 名学生的分组信息
正在加载批改结果...
  - 第2章: 40 个小组
  - 第8章: 40 个小组
  - 第11章: 40 个小组

正在生成输出文件...

成绩整理完成！已保存到: E:\Projects\Intelligent_Teaching_Assistant\二人小组作业-成绩整理.xlsx
共整理 78 名学生，3 个章节的成绩
  - 已分组学生: 78 人
  - 未分组学生: 0 人

处理完成！
输出文件: E:\Projects\Intelligent_Teaching_Assistant\二人小组作业-成绩整理.xlsx
```

## 技术细节

- **学号标准化**：使用 `normalize_student_id()` 函数统一处理学号格式
- **工作表自动识别**：自动查找包含"二人小组"或"十人小组"关键词的工作表
- **智能分组识别**：
  - 空组号行继承上一个组号
  - 完全空行重置当前组号
  - 支持单人小组和人数不定的小组
- **错误处理**：对文件读取、数据转换等操作进行了异常处理
- **兼容性**：支持 `.xls` 和 `.xlsx` 两种Excel格式

## 常见问题

### Q: 提示"找不到包含'二人小组'的工作表"
A: 检查分组文件中是否有包含"二人小组"关键词的工作表名称。

### Q: 某些学生显示"未分组"
A: 
1. 检查分组文件中是否包含该学生的学号
2. 注意学号格式要一致
3. 检查是否有完全空行导致组号被重置
4. 如果是单人小组，确保该学生所在行有组号或在有组号的行之后

### Q: 提示"Permission denied"
A: 关闭已打开的输出Excel文件，或选择使用带时间戳的文件名。

### Q: 分组表中有空组号的行怎么处理？
A: 脚本会自动处理：
- 如果某行组号为空但有学号，这些学号属于上一个组号
- 如果某行完全为空（所有列都是空），则重置组号，后续行需要新的组号

## 更新日志

### v1.1 (2026-01-15)
- ✅ 支持空组号行（继承上一个组号）
- ✅ 支持完全空行重置组号
- ✅ 支持单人小组
- ✅ 优化学号格式处理
- ✅ 添加详细的统计信息

### v1.0 (2026-01-15)
- ✅ 初始版本
- ✅ 基本的成绩整理功能
